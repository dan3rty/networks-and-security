# Описание алгоритма работы UDP Pinger

## 1. Расчет RTT (Round-Trip Time)

**RTT** — это время, затраченное на отправку запроса от клиента к серверу и получение ответа обратно. В программе расчет производится следующим образом:

1.  Для измерения времени используется функция `gettimeofday()`, которая заполняет структуру `struct timeval` (содержит секунды `tv_sec` и микросекунды `tv_usec`).
2.  **Фиксация времени отправки ($T_{start}$):** Непосредственно перед вызовом функции `sendto()` клиент сохраняет текущее время.
3.  **Фиксация времени получения ($T_{end}$):** Сразу после успешного выполнения функции `recvfrom()` (если ответ пришел) клиент снова сохраняет текущее время.
4.  **Вычисление разницы:**
    RTT вычисляется как разность между временем получения и временем отправки. Чтобы получить результат в секундах с дробной частью, используется формула:
    $$RTT = (T_{end}.sec - T_{start}.sec) + \frac{(T_{end}.usec - T_{start}.usec)}{1000000.0}$$
    Где деление микросекунд на $10^6$ переводит их в секунды.

**Особенность работы на localhost:**
Так как клиент и сервер запущены на одной машине, время передачи пакета через сетевой стек ОС (loopback interface) крайне мало (десятки микросекунд). При стандартном форматировании вывода (`%.3f`) это значение округляется до `0.000 сек`.

## 2. Обработка тайм-аутов (Timeout)

Так как протокол UDP не гарантирует доставку пакетов, программа не должна вечно ждать ответа от сервера (блокироваться). Для реализации механизма тайм-аута используется следующий алгоритм:

1.  **Настройка сокета:**
    При инициализации клиента, до входа в цикл отправки пакетов, устанавливается опция сокета `SO_RCVTIMEO` с помощью функции `setsockopt()`:
    ```cpp
    struct timeval tv_timeout;
    tv_timeout.tv_sec = 1;  // 1 секунда
    tv_timeout.tv_usec = 0;
    setsockopt(sockfd, SOL_SOCKET, SO_RCVTIMEO, &tv_timeout, sizeof(tv_timeout));
    ```
    Это сообщает операционной системе, что любые операции чтения из этого сокета не должны длиться дольше 1 секунды.

2.  **Ожидание ответа:**
    В функции `recvfrom()` программа ожидает прихода данных.
    *   **Сценарий А (Успех):** Если сервер прислал ответ в течение 1 секунды, `recvfrom` возвращает количество принятых байт ($>0$). Программа вычисляет RTT и выводит результат.
    *   **Сценарий Б (Тайм-аут):** Если в течение 1 секунды данные не поступили (пакет потерян или сервер недоступен), `recvfrom` прерывается и возвращает значение `-1`.

3.  **Обработка результата:**
    Программа проверяет возвращаемое значение. Если оно отрицательное (и код ошибки соответствует временной недоступности ресурса), в консоль выводится сообщение: `Request timed out`. При этом выполнение программы не прерывается, и цикл переходит к отправке следующего пакета.